<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TagTeam v3.0 Polarity Fix Verification</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 40px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #4CAF50;
            padding-bottom: 10px;
        }
        .test-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-title {
            font-size: 18px;
            font-weight: bold;
            color: #2196F3;
            margin-bottom: 10px;
        }
        .scenario {
            background: #f9f9f9;
            padding: 15px;
            border-left: 4px solid #2196F3;
            margin: 10px 0;
            font-style: italic;
        }
        .result {
            margin: 15px 0;
        }
        .value-item {
            padding: 8px;
            margin: 5px 0;
            background: #f0f0f0;
            border-radius: 4px;
        }
        .pass {
            color: #4CAF50;
            font-weight: bold;
        }
        .fail {
            color: #f44336;
            font-weight: bold;
        }
        .polarity-positive {
            color: #4CAF50;
        }
        .polarity-negative {
            color: #f44336;
        }
        .polarity-neutral {
            color: #FF9800;
        }
        .summary {
            background: #e3f2fd;
            border: 2px solid #2196F3;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
        }
        .summary.success {
            background: #e8f5e9;
            border-color: #4CAF50;
        }
        .summary.failure {
            background: #ffebee;
            border-color: #f44336;
        }
        pre {
            background: #263238;
            color: #aed581;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>ðŸ”¬ TagTeam v3.0 Polarity Detection Fix - Verification Test</h1>

    <div id="results">
        <p>Loading TagTeam v3.0...</p>
    </div>

    <!-- Load the NEW TagTeam v3.0 -->
    <script src="../dist/tagteam.js"></script>

    <script>
        // Verification Test Suite
        const resultsDiv = document.getElementById('results');
        let allTestsPassed = true;

        function runTests() {
            resultsDiv.innerHTML = '<h2>Running Tests...</h2>';

            // Test 1: Original broken scenario
            const test1 = runTest1();

            // Test 2: Verb inflection
            const test2 = runTest2();

            // Test 3: Possessive handling
            const test3 = runTest3();

            // Test 4: Negative scenario
            const test4 = runTest4();

            // Summary
            displaySummary();
        }

        function runTest1() {
            const html = [];
            html.push('<div class="test-section">');
            html.push('<div class="test-title">Test 1: Informed Consent Scenario (Original IEE Bug)</div>');

            const scenario = "A doctor provides evidence-based medical treatment to alleviate patient suffering, fully informing the patient of risks and obtaining their informed consent.";
            html.push(`<div class="scenario">${scenario}</div>`);

            const result = TagTeam.parse(scenario);

            html.push('<div class="result">');
            html.push('<strong>Detected Values:</strong>');

            if (result.ethicalProfile && result.ethicalProfile.values) {
                result.ethicalProfile.values.forEach(value => {
                    const polarityClass = value.polarity > 0 ? 'polarity-positive' :
                                         value.polarity < 0 ? 'polarity-negative' : 'polarity-neutral';
                    const polaritySymbol = value.polarity > 0 ? '+' : value.polarity < 0 ? '-' : '';
                    html.push(`<div class="value-item">` +
                             `<strong>${value.name}</strong>: ` +
                             `polarity = <span class="${polarityClass}">${polaritySymbol}${value.polarity}</span>, ` +
                             `salience = ${value.salience.toFixed(2)}` +
                             `</div>`);
                });

                html.push('</div>');

                // Verification
                html.push('<div class="result">');
                html.push('<strong>âœ“ Verification:</strong><br>');

                const autonomy = result.ethicalProfile.values.find(v => v.name === 'Autonomy');
                const consent = result.ethicalProfile.values.find(v => v.name === 'Consent');
                const compassion = result.ethicalProfile.values.find(v => v.name === 'Compassion');

                if (autonomy && autonomy.polarity > 0) {
                    html.push('<div class="pass">âœ“ Autonomy detected with POSITIVE polarity (was incorrectly neutral)</div>');
                } else {
                    html.push('<div class="fail">âœ— Autonomy NOT detected or has wrong polarity</div>');
                    allTestsPassed = false;
                }

                if (consent && consent.polarity > 0) {
                    html.push('<div class="pass">âœ“ Consent detected with POSITIVE polarity (was incorrectly neutral)</div>');
                } else {
                    html.push('<div class="fail">âœ— Consent NOT detected or has wrong polarity</div>');
                    allTestsPassed = false;
                }

                if (compassion && compassion.polarity > 0) {
                    html.push('<div class="pass">âœ“ Compassion detected with POSITIVE polarity</div>');
                } else {
                    html.push('<div class="fail">âœ— Compassion NOT detected or has wrong polarity</div>');
                    allTestsPassed = false;
                }

                if (result.ethicalProfile.judgment === 'permissible' || result.ethicalProfile.judgment === 'exemplary') {
                    html.push(`<div class="pass">âœ“ Judgment is ${result.ethicalProfile.judgment.toUpperCase()} (was incorrectly problematic)</div>`);
                } else {
                    html.push(`<div class="fail">âœ— Judgment is ${result.ethicalProfile.judgment} (should be permissible/exemplary)</div>`);
                    allTestsPassed = false;
                }

            } else {
                html.push('<div class="fail">âœ— No ethical profile detected</div>');
                allTestsPassed = false;
            }

            html.push('</div>');
            html.push('</div>');

            resultsDiv.innerHTML += html.join('');
        }

        function runTest2() {
            const html = [];
            html.push('<div class="test-section">');
            html.push('<div class="test-title">Test 2: Verb Inflection Handling</div>');

            const scenario = "The physician alleviates the patient's suffering by providing compassionate care.";
            html.push(`<div class="scenario">${scenario}</div>`);

            const result = TagTeam.parse(scenario);

            html.push('<div class="result">');
            html.push('<strong>Detected Values:</strong>');

            if (result.ethicalProfile && result.ethicalProfile.values) {
                result.ethicalProfile.values.forEach(value => {
                    const polarityClass = value.polarity > 0 ? 'polarity-positive' :
                                         value.polarity < 0 ? 'polarity-negative' : 'polarity-neutral';
                    const polaritySymbol = value.polarity > 0 ? '+' : value.polarity < 0 ? '-' : '';
                    html.push(`<div class="value-item">` +
                             `<strong>${value.name}</strong>: ` +
                             `polarity = <span class="${polarityClass}">${polaritySymbol}${value.polarity}</span>, ` +
                             `salience = ${value.salience.toFixed(2)}` +
                             `</div>`);
                });

                const compassion = result.ethicalProfile.values.find(v => v.name === 'Compassion');
                if (compassion && compassion.polarity > 0) {
                    html.push('<div class="pass">âœ“ "alleviates suffering" correctly matches "relieve suffering" pattern</div>');
                } else {
                    html.push('<div class="fail">âœ— Pattern matching failed for verb inflection</div>');
                    allTestsPassed = false;
                }
            }

            html.push('</div>');
            html.push('</div>');

            resultsDiv.innerHTML += html.join('');
        }

        function runTest3() {
            const html = [];
            html.push('<div class="test-section">');
            html.push('<div class="test-title">Test 3: Possessive Handling</div>');

            const scenario = "The patient's informed consent was obtained before the procedure.";
            html.push(`<div class="scenario">${scenario}</div>`);

            const result = TagTeam.parse(scenario);

            html.push('<div class="result">');
            html.push('<strong>Detected Values:</strong>');

            if (result.ethicalProfile && result.ethicalProfile.values) {
                result.ethicalProfile.values.forEach(value => {
                    const polarityClass = value.polarity > 0 ? 'polarity-positive' :
                                         value.polarity < 0 ? 'polarity-negative' : 'polarity-neutral';
                    const polaritySymbol = value.polarity > 0 ? '+' : value.polarity < 0 ? '-' : '';
                    html.push(`<div class="value-item">` +
                             `<strong>${value.name}</strong>: ` +
                             `polarity = <span class="${polarityClass}">${polaritySymbol}${value.polarity}</span>, ` +
                             `salience = ${value.salience.toFixed(2)}` +
                             `</div>`);
                });

                const autonomy = result.ethicalProfile.values.find(v => v.name === 'Autonomy');
                const consent = result.ethicalProfile.values.find(v => v.name === 'Consent');

                if ((autonomy && autonomy.polarity > 0) || (consent && consent.polarity > 0)) {
                    html.push('<div class="pass">âœ“ "patient\'s informed consent" correctly matches despite possessive</div>');
                } else {
                    html.push('<div class="fail">âœ— Possessive handling failed</div>');
                    allTestsPassed = false;
                }
            }

            html.push('</div>');
            html.push('</div>');

            resultsDiv.innerHTML += html.join('');
        }

        function runTest4() {
            const html = [];
            html.push('<div class="test-section">');
            html.push('<div class="test-title">Test 4: Negative Scenario (Values Violated)</div>');

            const scenario = "The doctor proceeded with treatment without obtaining informed consent.";
            html.push(`<div class="scenario">${scenario}</div>`);

            const result = TagTeam.parse(scenario);

            html.push('<div class="result">');
            html.push('<strong>Detected Values:</strong>');

            if (result.ethicalProfile && result.ethicalProfile.values) {
                result.ethicalProfile.values.forEach(value => {
                    const polarityClass = value.polarity > 0 ? 'polarity-positive' :
                                         value.polarity < 0 ? 'polarity-negative' : 'polarity-neutral';
                    const polaritySymbol = value.polarity > 0 ? '+' : value.polarity < 0 ? '-' : '';
                    html.push(`<div class="value-item">` +
                             `<strong>${value.name}</strong>: ` +
                             `polarity = <span class="${polarityClass}">${polaritySymbol}${value.polarity}</span>, ` +
                             `salience = ${value.salience.toFixed(2)}` +
                             `</div>`);
                });

                const autonomy = result.ethicalProfile.values.find(v => v.name === 'Autonomy');
                const consent = result.ethicalProfile.values.find(v => v.name === 'Consent');

                if ((autonomy && autonomy.polarity < 0) || (consent && consent.polarity < 0)) {
                    html.push('<div class="pass">âœ“ "without informed consent" correctly detected as VIOLATION</div>');
                } else {
                    html.push('<div class="fail">âœ— Negation handling may have issues</div>');
                    allTestsPassed = false;
                }

                if (result.ethicalProfile.judgment === 'problematic' || result.ethicalProfile.judgment === 'prohibited') {
                    html.push(`<div class="pass">âœ“ Judgment is correctly ${result.ethicalProfile.judgment.toUpperCase()}</div>`);
                } else {
                    html.push(`<div class="fail">âœ— Judgment is ${result.ethicalProfile.judgment} (should be problematic/prohibited)</div>`);
                    allTestsPassed = false;
                }
            }

            html.push('</div>');
            html.push('</div>');

            resultsDiv.innerHTML += html.join('');
        }

        function displaySummary() {
            const html = [];
            html.push(`<div class="summary ${allTestsPassed ? 'success' : 'failure'}">`);
            html.push('<h2>ðŸ“Š Test Summary</h2>');

            if (allTestsPassed) {
                html.push('<h3 class="pass">âœ“ ALL TESTS PASSED - IEE Polarity Bug is FIXED!</h3>');
                html.push('<p>The enhanced pattern matching successfully handles:</p>');
                html.push('<ul>');
                html.push('<li>âœ“ Verb inflections (obtaining â†’ obtain, alleviates â†’ alleviate)</li>');
                html.push('<li>âœ“ Possessives (patient\'s informed consent)</li>');
                html.push('<li>âœ“ Negations (without informed consent)</li>');
                html.push('<li>âœ“ Word order variations</li>');
                html.push('</ul>');
                html.push('<p><strong>Pattern matching now uses Compromise.js for lemmatization.</strong></p>');
                html.push('<p>TagTeam v3.0 is ready for production deployment.</p>');
            } else {
                html.push('<h3 class="fail">âœ— SOME TESTS FAILED</h3>');
                html.push('<p>Please review the test results above and check the TagTeam v3.0 implementation.</p>');
            }

            html.push('</div>');

            resultsDiv.innerHTML += html.join('');
        }

        // Run tests when page loads
        if (typeof TagTeam !== 'undefined') {
            console.log('TagTeam version:', TagTeam.version);
            runTests();
        } else {
            resultsDiv.innerHTML = '<div class="fail">âœ— TagTeam failed to load!</div>';
        }
    </script>
</body>
</html>
